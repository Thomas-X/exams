{"version":3,"sources":["webpack:///webpack/bootstrap bc23e6f8a48324cdd2a0","webpack:///./node_modules/babel-runtime/regenerator/index.js","webpack:///external \"express\"","webpack:///external \"chalk\"","webpack:///external \"is-js\"","webpack:///external \"mongoose\"","webpack:///./src/controllers/home.js","webpack:///./src/global/models/User.js","webpack:///./src/index.js","webpack:///external \"regenerator-runtime\"","webpack:///external \"body-parser\"","webpack:///external \"cors\"","webpack:///external \"http\"","webpack:///external \"ip\"","webpack:///./src/factories/createAuthHandler.js","webpack:///external \"passport\"","webpack:///external \"passport-jwt\"","webpack:///./src/global/constants.js","webpack:///./src/controllers/auth.js","webpack:///external \"bcrypt\"","webpack:///external \"express-validator/check\"","webpack:///external \"jsonwebtoken\"","webpack:///external \"uuid/v4\"","webpack:///./src/services/log.js","webpack:///external \"stack-trace\"","webpack:///./src/socket.js","webpack:///external \"socket.io\"","webpack:///external \"dotenv\"","webpack:///./src/controllers/api.js","webpack:///./src/global/models/Account.js","webpack:///./src/global/models/Organisation.js"],"names":["Home","Router","get","req","res","send","schema","mongoose","Schema","id","type","String","required","unique","username","maxLength","password","role","default","creditCardId","accountId","organisationId","User","model","require","config","Server","onListen","err","error","port","process","env","__DEV__","warn","info","ip","address","toString","connectToDb","connect","useMongoClient","Promise","global","db","connection","on","console","log","Error","once","start","catch","app","use","bodyParser","json","cors","createAuthHandler","setRoutes","http","socket","bindSockets","listen","route","isPrivate","allowedRoles","path","controller","is","set","checkRole","next","length","express","PORT","options","jwtFromRequest","ExtractJwt","fromExtractors","fromAuthHeaderAsBearerToken","fromUrlQueryParameter","fromHeader","secretOrKey","secretKey","passport","jwtPayload","done","find","sub","user","authMiddleware","authenticate","session","ROLES","admin","manager","ROUTES","Auth","validations","check","exists","isAlphanumeric","isLength","min","checkIfValidatorFailed","errors","validationResult","isEmpty","message","formatWith","param","array","status","post","body","password1","uuid","hash","Number","salt","create","token","sign","compare","misc","DEBUG","content","trace","funcName","getFunctionName","substr","rest","debug","Socket","io","Api","Account","accounts","accountsCopy","slice","query","addRedundancy","resolve","forEach","account","index","Organisation","org","_doc","organisation","organisationName","creditCardIds","name","orgResult","accountResult","creditCards","balance"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 7);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap bc23e6f8a48324cdd2a0","module.exports = require(\"regenerator-runtime\");\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/babel-runtime/regenerator/index.js\n// module id = 0\n// module chunks = 0","module.exports = require(\"express\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express\"\n// module id = 1\n// module chunks = 0","module.exports = require(\"chalk\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"chalk\"\n// module id = 2\n// module chunks = 0","module.exports = require(\"is-js\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"is-js\"\n// module id = 3\n// module chunks = 0","module.exports = require(\"mongoose\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"mongoose\"\n// module id = 4\n// module chunks = 0","import { Router } from 'express';\n\nconst Home = Router();\n\nHome.get('/', (req, res) => {\n    res.send('hi from home');\n});\n\nexport default Home;\n\n\n// WEBPACK FOOTER //\n// ./src/controllers/home.js","import mongoose from 'mongoose';\n\nconst schema = new mongoose.Schema({\n\tid: { type: String, required: true, unique: true },\n\tusername: { type: String, maxLength: 255, required: true, unique: true, },\n\tpassword: { type: String, maxLength: 255, required: true },\n\trole: { type: String, maxLength: 255, required: true, default: 'user' },\n\tcreditCardId: { type: String, maxLength: 255, default: '' },\n\taccountId: { type: String, maxLength: 255, default: '' },\n\torganisationId: { type: String, maxLength: 255, default: ''},\n});\n\nconst User = mongoose.model('User', schema);\n\nexport default User;\n\n\n\n// WEBPACK FOOTER //\n// ./src/global/models/User.js","import bodyParser from 'body-parser';\nimport chalk from 'chalk';\nimport * as cors from 'cors';\nimport express from 'express';\nimport { Server as HttpServer } from 'http';\nimport ip from 'ip';\nimport is from 'is-js';\nimport mongoose from 'mongoose';\nimport Api from './controllers/api';\nimport Home from './controllers/home';\nimport createAuthHandler, { authMiddleware } from './factories/createAuthHandler';\nimport { ROUTES } from './global/constants';\nimport { error, info, warn } from './services/log';\nimport Socket from './socket';\n\nrequire('dotenv').config();\n\nclass Server {\n\tport;\n\n\tconstructor () {\n\t\tthis.app = express();\n\t\tthis.port = process.env.PORT || 3004;\n\t\tthis.connectToDb()\n\t\t\t.catch(err => error(err));\n\t}\n\n\tonListen = (err) => {\n\t\tif (err) {\n\t\t\terror(`Unable to start server on port ${this.port}`, err);\n\t\t\treturn;\n\t\t}\n\n\t\tif (process.env.__DEV__) {\n\t\t\twarn('We\\'re in development mode.');\n\t\t}\n\n\t\tinfo(`We're live.\\r\\n`);\n\t\tinfo(chalk`{bold On your network:}     {underline http://${ip.address('public')}:{bold ${this.port.toString()}}/}`);\n\t\tinfo(chalk`Local:               {underline http://${ip.address('private')}:{bold ${this.port.toString()}}/}`);\n\t};\n\n\tconnectToDb = async () => {\n\t\ttry {\n\t\t\tmongoose.connect('mongodb://127.0.0.1/proefExamenTest', {\n\t\t\t\tuseMongoClient: true,\n\t\t\t});\n\t\t\tmongoose.Promise = global.Promise;\n\t\t\tconst db = mongoose.connection;\n\n\t\t\tdb.on('error', (err) => {\n\t\t\t\tconsole.log();\n\t\t\t\terror(err);\n\t\t\t\tthrow new Error(err);\n\t\t\t});\n\t\t\tdb.once('open', () => {\n\t\t\t\tinfo('Successfully connected to database!');\n\t\t\t\tconsole.log();\n\t\t\t\tthis.start()\n\t\t\t\t\t.catch(err => {\n\t\t\t\t\t\tconsole.log();\n\t\t\t\t\t\terror(err);\n\t\t\t\t\t\tthrow new Error(err);\n\t\t\t\t\t});\n\t\t\t});\n\t\t} catch (err) {\n\t\t\tthrow new Error(err);\n\t\t}\n\t};\n\n\tstart = async () => {\n\t\tthis.app.use(bodyParser.json());\n\t\t// TODO Change cors to not allow all origins, just frontend location.\n\t\tthis.app.use(cors());\n\t\tcreateAuthHandler();\n\t\tthis.setRoutes();\n\t\tconst http = new HttpServer(this.app);\n\t\tthis.socket = new Socket(http);\n\t\tthis.socket.bindSockets();\n\t\thttp.listen(this.port, this.onListen);\n\t};\n\n\tsetRoutes = () => {\n\n\t\tfor (const route of ROUTES) {\n\t\t\tconst { isPrivate, allowedRoles, path, controller } = route;\n\n\t\t\tif (!is.set(isPrivate) || !is.set(allowedRoles) || !is.set(path) || !is.set(controller) || typeof controller !== 'function') {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst checkRole = (req, res, next) => {\n\t\t\t\t// TODO implement roles. Get user via req.user and check if the role is supported\n\t\t\t\tnext();\n\t\t\t};\n\n\t\t\tif (isPrivate === true && allowedRoles.length === 0) {\n\t\t\t\tthis.app.use(path, authMiddleware, controller);\n\t\t\t} else if (allowedRoles.length > 0 && isPrivate === true) {\n\t\t\t\tthis.app.use(path, authMiddleware, checkRole, controller);\n\t\t\t} else if (isPrivate === false) {\n\t\t\t\tthis.app.use(path, controller);\n\t\t\t}\n\t\t}\n\n\t\tthis.app.use('/', Home);\n\t\tthis.app.use('/api', Api);\n\n\t\t// use auth middleware to auth routes.\n\t\tthis.app.use(authMiddleware);\n\n\t\tthis.app.use('/someAuthedRoute', (req, res) => {\n\t\t\tres.send('hi from authed route');\n\t\t});\n\t};\n}\n\nexport default new Server();\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","module.exports = require(\"regenerator-runtime\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"regenerator-runtime\"\n// module id = 9\n// module chunks = 0","module.exports = require(\"body-parser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"body-parser\"\n// module id = 10\n// module chunks = 0","module.exports = require(\"cors\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"cors\"\n// module id = 11\n// module chunks = 0","module.exports = require(\"http\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"http\"\n// module id = 12\n// module chunks = 0","module.exports = require(\"ip\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"ip\"\n// module id = 13\n// module chunks = 0","import passport from 'passport';\nimport { ExtractJwt, Strategy } from 'passport-jwt';\nimport User from '../global/models/User';\n\nexport default () => {\n    const options = {\n        jwtFromRequest: ExtractJwt.fromExtractors([\n            ExtractJwt.fromAuthHeaderAsBearerToken(),\n            ExtractJwt.fromUrlQueryParameter('auth'),\n            ExtractJwt.fromHeader('authenticationToken'),\n        ]),\n        secretOrKey: process.env.secretKey,\n    };\n\n    passport.use(new Strategy(options, async (jwtPayload, done) => {\n        const user = (await User.find({ id: jwtPayload.sub }))[0];\n        if (user) {\n            return done(null, user);\n        } else {\n            return done(null, false);\n        }\n    }));\n}\n\nexport const authMiddleware = passport.authenticate('jwt', { session: false });\n\n\n// WEBPACK FOOTER //\n// ./src/factories/createAuthHandler.js","module.exports = require(\"passport\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"passport\"\n// module id = 15\n// module chunks = 0","module.exports = require(\"passport-jwt\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"passport-jwt\"\n// module id = 16\n// module chunks = 0","import Auth from '../controllers/auth';\nimport Home from '../controllers/home';\n\nexport const ROLES = {\n    admin: 'admin',\n    manager: 'manager',\n    user: 'user',\n};\n\nexport const ROUTES = [\n    {\n        path: '/',\n        controller: Home,\n        allowedRoles: [],\n        isPrivate: false,\n    },\n    {\n        path: '/auth',\n        controller: Auth,\n        allowedRoles: [],\n        isPrivate: false,\n    },\n    {\n        path: '/someAuthedRoute',\n        controller: (req, res) => {\n            res.send('hi from authed route');\n        },\n        allowedRoles: [],\n        isPrivate: true,\n    },\n];\n\n\n// WEBPACK FOOTER //\n// ./src/global/constants.js","import { compare, hash } from 'bcrypt';\nimport { Router } from 'express';\nimport { check, validationResult } from 'express-validator/check';\nimport is from 'is-js';\nimport { sign } from 'jsonwebtoken';\nimport uuid from 'uuid/v4';\nimport User from '../global/models/User';\n\nconst Auth = Router();\n\nconst validations = [\n    check('username').exists().isAlphanumeric(),\n    check('password1').exists().isLength({ min: 6 }),\n];\n\nconst checkIfValidatorFailed = async (req, res, next) => {\n    const errors = validationResult(req);\n    if (!errors.isEmpty()) {\n        const message = errors.formatWith(({ param }) => {\n            return `Invalid ${param} value`;\n        }).array();\n        return res.status(422).json({ message: message[message.length - 1] });\n    }\n    next();\n};\n\nAuth.post('/register', validations, checkIfValidatorFailed, async (req, res, next) => {\n    try {\n        const { username, password1 } = req.body;\n        const user = (await User.find({ username: username }))[0];\n        if (is.set(user)) {\n            res.status(422);\n            return res.json({\n                message: 'User already exists',\n            });\n        } else if (!is.set(user)) {\n            const id = uuid();\n            const user = {\n                id,\n                username,\n                password: await hash(password1, Number(process.env.salt)),\n            };\n            await User.create(user);\n            return res.json({\n                token: sign({ sub: id }, process.env.secretKey),\n            });\n        }\n    } catch (err) {\n        next(err);\n    }\n});\n\nAuth.post('/login', validations, checkIfValidatorFailed, async (req, res, next) => {\n    try {\n        const { username, password1 } = req.body;\n        const user = (await User.find({ username: username }))[0];\n        if (!user) {\n            res.status(422);\n            return res.json({\n                message: 'User does not exist',\n            });\n        }\n        if (!await compare(password1, user.password)) {\n            res.status(422);\n            return res.json({\n                message: 'Incorrect password',\n            });\n        }\n        return res.json({\n            token: sign({ sub: user.id }, process.env.secretKey),\n        });\n    } catch (err) {\n        next(err);\n    }\n});\n\nexport default Auth;\n\n\n// WEBPACK FOOTER //\n// ./src/controllers/auth.js","module.exports = require(\"bcrypt\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"bcrypt\"\n// module id = 19\n// module chunks = 0","module.exports = require(\"express-validator/check\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express-validator/check\"\n// module id = 20\n// module chunks = 0","module.exports = require(\"jsonwebtoken\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jsonwebtoken\"\n// module id = 21\n// module chunks = 0","module.exports = require(\"uuid/v4\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"uuid/v4\"\n// module id = 22\n// module chunks = 0","import chalk from 'chalk';\nimport { get } from 'stack-trace';\n\nconst log = (type = 'log', message, ...misc) => {\n    if (type === 'debug' && process.env.DEBUG !== 'true') {\n        return;\n    }\n    let content = [];\n    switch (type) {\n        case 'log':\n            content = [chalk`{bold.cyan INFO}`];\n            break;\n        case 'error':\n            content = [chalk`{bold.red ERR!}`];\n            break;\n        case 'warn':\n            content = [chalk`{bold.yellow WARN}`];\n            break;\n        case 'debug': {\n            const trace = get();\n            const funcName = trace[2].getFunctionName();\n            content = [chalk`{bold.magenta VERB} ${funcName ? chalk`{bgBlack.white  ${funcName.substr(0, 15)} }` : ''}`];\n            break;\n        }\n        default:\n            throw new Error(`Invalid log type: ${type}`);\n    }\n\n    content = [...content, message, ...misc];\n\n    console[type === 'debug' ? 'log' : type](...content);\n};\n\nexport const info = (message, ...rest) => log('log', message, ...rest);\nexport const error = (message, ...rest) => log('error', message, ...rest);\nexport const warn = (message, ...rest) => log('warn', message, ...rest);\nexport const debug = (message, ...rest) => log('debug', message, ...rest);\n\n\n// WEBPACK FOOTER //\n// ./src/services/log.js","module.exports = require(\"stack-trace\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"stack-trace\"\n// module id = 24\n// module chunks = 0","import io from 'socket.io';\n\nexport default class Socket {\n\n    constructor (http) {\n        this.io = io(http);\n    }\n\n    bindSockets () {\n        // bind sockets here\n        // samples\n        // this.io.emit('bla', {bla: 'bla' });\n        // this.io.on('bla', (data) => { info(data) });\n    }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/socket.js","module.exports = require(\"socket.io\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"socket.io\"\n// module id = 26\n// module chunks = 0","module.exports = require(\"dotenv\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"dotenv\"\n// module id = 27\n// module chunks = 0","import { Router } from 'express';\nimport uuid from 'uuid/v4';\nimport { authMiddleware } from '../factories/createAuthHandler';\nimport Account from '../global/models/Account';\nimport Organisation from '../global/models/Organisation';\n\nconst Api = Router();\n\nApi.get('/', (req, res) => {\n\tres.send('hi from Api');\n});\n\nApi.get('/getAllAccounts', async (req, res) => {\n\tlet accounts = await Account.find({});\n\tconst accountsCopy = accounts.slice();\n\tif (req.query.addRedundancy == 'true') {\n\t\tawait new Promise((resolve) => {\n\t\t\taccountsCopy.forEach(async (account, index) => {\n\t\t\t\tconst org = (await Organisation.find({ id: account.organisationId }))[0];\n\t\t\t\taccountsCopy[index]._doc.organisation = org;\n\t\t\t\tif ((index + 1) === accountsCopy.length) {\n\t\t\t\t\tresolve();\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\tres.json({\n\t\taccounts: accountsCopy,\n\t});\n});\n\nApi.post('/createAccount', authMiddleware, async (req, res) => {\n\ttry {\n\t\tconst { organisationName, accountId, creditCardIds } = req.body;\n\t\tlet organisation = await Organisation.find({ name: organisationName });\n\n\t\t// if no organisation, make one\n\n\t\t// but first check if exists..\n\t\tconst orgResult = (await Organisation.find({ name: organisationName}));\n\t\tconsole.log(orgResult);\n\t\tif(orgResult.length > 0) {\n\t\t\tres.status(422);\n\t\t\treturn res.json({\n\t\t\t\tmessage: 'Organisation already exists',\n\t\t\t});\n\t\t}\n\n\t\tif (organisation.length <= 0) {\n\t\t\tconst id = uuid();\n\t\t\torganisation = await Organisation.create({\n\t\t\t\tid,\n\t\t\t\tname: organisationName,\n\t\t\t});\n\t\t}\n\t\t// mongoose returns an array, select first index.\n\t\torganisation = organisation[0];\n\t\t// Check if account exists\n\t\tconst accountResult = (await Account.find({ id: accountId }));\n\t\tif (accountResult.length > 0) {\n\t\t\tres.status(422);\n\t\t\treturn res.json({\n\t\t\t\tmessage: 'Account already exists',\n\t\t\t});\n\t\t}\n\n\t\tif(!organisation) {\n\t\t\torganisation = (await Organisation.find({ name: organisationName }))[0];\n\t\t}\n\n\t\tconst account = await Account.create({\n\t\t\tid: accountId,\n\t\t\torganisationId: organisation.id,\n\t\t\tcreditCards: creditCardIds,\n\t\t\tbalance: 0,\n\t\t});\n\n\t\t// add organisation redundancy\n\t\tif (req.query.addRedundancy == 'true') {\n\t\t\taccount._doc.organisation = organisation;\n\t\t}\n\n\t\tres.json({\n\t\t\taccount,\n\t\t});\n\t} catch (err) {\n\t\tconsole.log(err);\n\t\tres.status(500).json({ errors: err });\n\t}\n});\n\nexport default Api;\n\n\n// WEBPACK FOOTER //\n// ./src/controllers/api.js","import mongoose from 'mongoose';\n\nconst schema = new mongoose.Schema({\n    id: { type: String, required: true, unique: true },\n\torganisationId: { type: String, maxLength: 255, default: ''},\n    creditCards: { type: [], default: []},\n    balance: { type: Number, default: 0 },\n});\n\nconst Account = mongoose.model('Account', schema);\n\nexport default Account;\n\n\n\n// WEBPACK FOOTER //\n// ./src/global/models/Account.js","import mongoose from 'mongoose';\n\nconst schema = new mongoose.Schema({\n\tname: { type: String, required: true, unique: true, maxLength: 255 },\n\tid: { type: String, maxLength: 255, unique: true },\n});\n\nconst Organisation = mongoose.model('Organisation', schema);\n\nexport default Organisation;\n\n\n\n// WEBPACK FOOTER //\n// ./src/global/models/Organisation.js"],"sourceRoot":""}